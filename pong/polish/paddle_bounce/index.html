<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.55.6" />
    <meta name="description" content="Documentation for Encompass ECS">
<meta name="author" content="Evan Hemsley">

    <link rel="icon" href="/images/favicon.png" type="image/png">

    <title>Paddle Bounce :: Encompass Docs</title>

    
    <link href="/css/nucleus.css?1561583309" rel="stylesheet">
    <link href="/css/fontawesome-all.min.css?1561583309" rel="stylesheet">
    <link href="/css/hybrid.css?1561583309" rel="stylesheet">
    <link href="/css/featherlight.min.css?1561583309" rel="stylesheet">
    <link href="/css/perfect-scrollbar.min.css?1561583309" rel="stylesheet">
    <link href="/css/auto-complete.css?1561583309" rel="stylesheet">
    <link href="/css/atom-one-dark-reasonable.css?1561583309" rel="stylesheet">
    <link href="/css/theme.css?1561583309" rel="stylesheet">
    <link href="/css/hugo-theme.css?1561583309" rel="stylesheet">
    <link href="/css/syntax.css?1561583309" rel="stylesheet">
    
      <link href="/css/theme-encompass.css?1561583309" rel="stylesheet">
    

    <script src="/js/jquery-3.3.1.min.js?1561583309"></script>

    <style type="text/css">
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/pong/polish/paddle_bounce/">
    <nav id="sidebar" class="">



  <div id="header-wrapper">
    <div id="header">
      <a href="/index.html"><img src="/images/logo-and-text.png" width="200"></a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/js/lunr.min.js?1561583309"></script>
<script type="text/javascript" src="/js/auto-complete.js?1561583309"></script>
<script type="text/javascript">
    
        var baseurl = "\/";
    
</script>
<script type="text/javascript" src="/js/search.js?1561583309"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/why/" title="Why?" class="dd-item 
        
        
        
        ">
      <a href="/why/">
          <b>1. </b>Why?
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
    <li data-nav-id="/why/the_hard_way/" title="The Hard Way" class="dd-item 
        
        
        
        ">
      <a href="/why/the_hard_way/">
          The Hard Way
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/why/architecture/" title="Architecture" class="dd-item 
        
        
        
        ">
      <a href="/why/architecture/">
          Architecture
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/why/architecture/mess/" title="The Messy Basement" class="dd-item ">
        <a href="/why/architecture/mess/">
        The Messy Basement
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/why/architecture/oop/" title="OOP" class="dd-item ">
        <a href="/why/architecture/oop/">
        OOP
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/why/architecture/ecs/" title="ECS" class="dd-item ">
        <a href="/why/architecture/ecs/">
        ECS
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/why/architecture/hyper_ecs/" title="Hyper ECS" class="dd-item ">
        <a href="/why/architecture/hyper_ecs/">
        Hyper ECS
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/getting_started/" title="Getting Started" class="dd-item 
        
        
        
        ">
      <a href="/getting_started/">
          <b>2. </b>Getting Started
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/getting_started/choosing/" title="Choosing An Engine" class="dd-item ">
        <a href="/getting_started/choosing/">
        Choosing An Engine
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting_started/terminal/" title="The Terminal" class="dd-item ">
        <a href="/getting_started/terminal/">
        The Terminal
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting_started/editor/" title="The Text Editor" class="dd-item ">
        <a href="/getting_started/editor/">
        The Text Editor
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting_started/version_control/" title="Version Control" class="dd-item ">
        <a href="/getting_started/version_control/">
        Version Control
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting_started/case_study_love/" title="Case Study: LÖVE" class="dd-item ">
        <a href="/getting_started/case_study_love/">
        Case Study: LÖVE
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/getting_started/project_structure/" title="LÖVE Project Structure" class="dd-item ">
        <a href="/getting_started/project_structure/">
        LÖVE Project Structure
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/concepts/" title="Concepts" class="dd-item 
        
        
        
        ">
      <a href="/concepts/">
          <b>3. </b>Concepts
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/concepts/component/" title="Component" class="dd-item ">
        <a href="/concepts/component/">
        Component
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/concepts/message/" title="Message" class="dd-item ">
        <a href="/concepts/message/">
        Message
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/concepts/entity/" title="Entity" class="dd-item ">
        <a href="/concepts/entity/">
        Entity
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/concepts/engine/" title="Engine" class="dd-item ">
        <a href="/concepts/engine/">
        Engine
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/concepts/renderer/" title="Renderer" class="dd-item ">
        <a href="/concepts/renderer/">
        Renderer
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/concepts/world_builder/" title="World Builder" class="dd-item ">
        <a href="/concepts/world_builder/">
        World Builder
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/concepts/world/" title="World" class="dd-item ">
        <a href="/concepts/world/">
        World
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/pong/" title="Pong" class="dd-item 
        parent
        
        
        ">
      <a href="/pong/">
          <b>4. </b>Pong
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pong/introduction/" title="Intro" class="dd-item ">
        <a href="/pong/introduction/">
        Intro
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pong/draw_paddle/" title="Drawing a Paddle" class="dd-item 
        
        
        
        ">
      <a href="/pong/draw_paddle/">
          Drawing a Paddle
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pong/draw_paddle/canvas_component/" title="Canvas Component" class="dd-item ">
        <a href="/pong/draw_paddle/canvas_component/">
        Canvas Component
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/draw_paddle/position_component/" title="Position Component" class="dd-item ">
        <a href="/pong/draw_paddle/position_component/">
        Position Component
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/draw_paddle/canvas_renderer/" title="Canvas Renderer" class="dd-item ">
        <a href="/pong/draw_paddle/canvas_renderer/">
        Canvas Renderer
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/draw_paddle/initialize_world/" title="Initializing the World" class="dd-item ">
        <a href="/pong/draw_paddle/initialize_world/">
        Initializing the World
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/draw_paddle/first_run/" title="First Run" class="dd-item ">
        <a href="/pong/draw_paddle/first_run/">
        First Run
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pong/move_paddle/" title="Moving the Paddle" class="dd-item 
        
        
        
        ">
      <a href="/pong/move_paddle/">
          Moving the Paddle
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pong/move_paddle/motion_engine/" title="Motion Engine" class="dd-item ">
        <a href="/pong/move_paddle/motion_engine/">
        Motion Engine
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/move_paddle/input_handling/" title="Input Handling" class="dd-item ">
        <a href="/pong/move_paddle/input_handling/">
        Input Handling
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/move_paddle/frame_dependence/" title="Frame-Dependence" class="dd-item ">
        <a href="/pong/move_paddle/frame_dependence/">
        Frame-Dependence
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/move_paddle/magic_values/" title="Magic Values" class="dd-item ">
        <a href="/pong/move_paddle/magic_values/">
        Magic Values
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/move_paddle/decoupling/" title="Decoupling" class="dd-item ">
        <a href="/pong/move_paddle/decoupling/">
        Decoupling
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pong/ball/" title="Ball" class="dd-item 
        
        
        
        ">
      <a href="/pong/ball/">
          Ball
          
      </a>
      
      
        <ul>
          
          
            
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/spawning/" title="Spawning" class="dd-item ">
        <a href="/pong/ball/spawning/">
        Spawning
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/moving/" title="Moving" class="dd-item ">
        <a href="/pong/ball/moving/">
        Moving
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pong/ball/bouncing/" title="Bouncing" class="dd-item 
        
        
        
        ">
      <a href="/pong/ball/bouncing/">
          Bouncing
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/bouncing/library_integration/" title="Library Integration" class="dd-item ">
        <a href="/pong/ball/bouncing/library_integration/">
        Library Integration
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/bouncing/design/" title="Design" class="dd-item ">
        <a href="/pong/ball/bouncing/design/">
        Design
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/bouncing/motion_engine/" title="Motion Engine: The Revenge" class="dd-item ">
        <a href="/pong/ball/bouncing/motion_engine/">
        Motion Engine: The Revenge
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/bouncing/collision_checking/" title="Collision Checking" class="dd-item ">
        <a href="/pong/ball/bouncing/collision_checking/">
        Collision Checking
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/bouncing/collision_dispatch/" title="Collision Dispatch" class="dd-item ">
        <a href="/pong/ball/bouncing/collision_dispatch/">
        Collision Dispatch
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/bouncing/collision_resolution/" title="Collision Resolution" class="dd-item ">
        <a href="/pong/ball/bouncing/collision_resolution/">
        Collision Resolution
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/bouncing/spawners/" title="Spawners" class="dd-item ">
        <a href="/pong/ball/bouncing/spawners/">
        Spawners
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/ball/bouncing/putting_it_together/" title="Putting It All Together" class="dd-item ">
        <a href="/pong/ball/bouncing/putting_it_together/">
        Putting It All Together
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pong/opponent/" title="The Opponent" class="dd-item 
        
        
        
        ">
      <a href="/pong/opponent/">
          The Opponent
          
      </a>
      
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pong/scoring/" title="Scoring" class="dd-item 
        
        
        
        ">
      <a href="/pong/scoring/">
          Scoring
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pong/scoring/goal_collision/" title="Goal Collision" class="dd-item ">
        <a href="/pong/scoring/goal_collision/">
        Goal Collision
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/scoring/ball_respawn/" title="Ball Respawn" class="dd-item ">
        <a href="/pong/scoring/ball_respawn/">
        Ball Respawn
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/scoring/tracking_score/" title="Tracking the Score" class="dd-item ">
        <a href="/pong/scoring/tracking_score/">
        Tracking the Score
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/scoring/drawing_score/" title="Drawing the Score" class="dd-item ">
        <a href="/pong/scoring/drawing_score/">
        Drawing the Score
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/scoring/center_line/" title="Center Line" class="dd-item ">
        <a href="/pong/scoring/center_line/">
        Center Line
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pong/polish/" title="Finishing Touches" class="dd-item 
        parent
        
        
        ">
      <a href="/pong/polish/">
          Finishing Touches
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/pong/polish/paddle_bounce/" title="Paddle Bounce" class="dd-item active">
        <a href="/pong/polish/paddle_bounce/">
        Paddle Bounce
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/polish/title/" title="Title" class="dd-item ">
        <a href="/pong/polish/title/">
        Title
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/pong/polish/win_condition/" title="Win Condition" class="dd-item ">
        <a href="/pong/polish/win_condition/">
        Win Condition
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

            
          
            
            


 
  
    
    <li data-nav-id="/pong/conclusion/" title="Conclusion" class="dd-item 
        
        
        
        ">
      <a href="/pong/conclusion/">
          Conclusion
          
      </a>
      
              
    </li>
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/notes/" title="Notes" class="dd-item 
        
        
        
        ">
      <a href="/notes/">
          <b>A. </b>Notes
          
      </a>
      
      
        <ul>
          
          
          
          
        
          
            
            


 
  
    
      <li data-nav-id="/notes/api_reference/" title="API Reference" class="dd-item ">
        <a href="/notes/api_reference/">
        API Reference
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/notes/acknowledgments/" title="Acknowledgments" class="dd-item ">
        <a href="/notes/acknowledgments/">
        Acknowledgments
        
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/notes/license/" title="License" class="dd-item ">
        <a href="/notes/license/">
        License
        
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    

    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="http://getgrav.org">Grav</a> and <a href="http://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            
            
          
          
            <a href='/'>Encompass</a> > <a href='/pong/'>Pong</a> > <a href='/pong/polish/'>Finishing Touches</a> > Paddle Bounce
          
        
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">

    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Paddle Bounce
            </h1>
          

        



<p>One thing that isn&rsquo;t quite right in our game is that when the ball bounces, it reflects directly off the paddle.</p>

<p>If we look at the original Pong, we see that the angle of the ball is actually affected by the position where the ball hits the paddle. If the ball hits the edges of the paddle, it bounces off at a wider angle. If it hits the center of the paddle, it bounces horizontally.</p>

<p>This is a classic risk/reward mechanic: it&rsquo;s safer to hit the center of the paddle, but it&rsquo;s easier for your opponent to return the shot. It&rsquo;s riskier to hit the edges of the paddle, but the shot is more difficult to return.</p>

<p>Let&rsquo;s return to our BallPaddleCollisionEngine.</p>

<pre><code class="language-ts">const velocity_message = this.emit_component_message(UpdateVelocityMessage, ball_velocity);
velocity_message.x_delta = 2 * message.normal.x * Math.abs(ball_velocity.x);
velocity_message.y_delta = 2 * message.normal.y * Math.abs(ball_velocity.y);
</code></pre>

<p>This is what is reflecting our ball&rsquo;s velocity.</p>

<p>Let&rsquo;s calculate a new velocity based on where the ball touches the paddle.</p>

<p>First, we don&rsquo;t want the speed of the ball to change. So let&rsquo;s store it. The way we calculate speed is by obtaining the length of the velocity. We also want to know if the ball was travelling right or left at the time of contact.</p>

<pre><code class="language-ts">const speed = len(ball_velocity.x, ball_velocity.y);
const horizontal = ball_velocity.x &lt; 0 ? 1 : -1;
</code></pre>

<p>Now we want to calculate our new angle. First, we want to check how far the point of contact was from the center of the paddle. The problem is that we don&rsquo;t know inside our engine how big the paddle is. Let&rsquo;s fix that.</p>

<p>Let&rsquo;s return to our PaddleMoveSpeedComponent.</p>

<pre><code class="language-ts">import { Component } from &quot;encompass-ecs&quot;;

export class PaddleMoveSpeedComponent extends Component {
    public y: number;
}
</code></pre>

<p>I think we should just store all of our paddle-related information here, so let&rsquo;s rename it to PaddleComponent, and rename <em>y</em> to <em>move_speed</em>. Make sure to use VSCode&rsquo;s rename feature so you don&rsquo;t have to manually tweak the names in multiple files.</p>

<pre><code class="language-ts">import { Component } from &quot;encompass-ecs&quot;;

export class PaddleComponent extends Component {
    public height: number;
    public move_speed: number;
}
</code></pre>

<p>Let&rsquo;s change our PaddleSpawner to comply with our changed component.</p>

<pre><code class="language-ts">const paddle_component = paddle_entity.add_component(PaddleComponent);
paddle_component.move_speed = message.move_speed;
paddle_component.height = height;
</code></pre>

<p>Now, back in our collision engine, we can get a new rotation. First, we figure out how far the contact was from the center of the paddle. Then we convert that to a number ranging from -1 to 1. Finally, we multiply that number by pi/4 to get a number ranging from -pi/4 to pi/4.</p>

<pre><code class="language-ts">const diff = message.touch.y - paddle_y;
const scale = diff / (paddle_height * 0.5);
const rotation = (scale * math.pi / 4);
</code></pre>

<p>Then we perform the rotation on a vector pointing directly to the right, with the same length we calculated earlier. We multiply it to reverse its direction if it was originally travelling to the right.</p>

<pre><code class="language-ts">let [new_x_velocity, new_y_velocity] = rotate(rotation, speed, 0);
new_x_velocity *= horizontal;
</code></pre>

<p>Finally, we create our velocity deltas by subtracting our old velocity from our new desired velocity.</p>

<pre><code class="language-ts">[
    velocity_message.x_delta,
    velocity_message.y_delta,
] = sub(new_x_velocity, new_y_velocity, ball_velocity.x, ball_velocity.y);
</code></pre>

<p>Our final result looks like this:</p>

<pre><code class="language-ts">import { Emits, Engine, Reads } from &quot;encompass-ecs&quot;;
import { BoundingBoxComponent } from &quot;game/components/bounding_box&quot;;
import { PaddleComponent } from &quot;game/components/paddle&quot;;
import { PositionComponent } from &quot;game/components/position&quot;;
import { VelocityComponent } from &quot;game/components/velocity&quot;;
import { BallPaddleCollisionMessage } from &quot;game/messages/collisions/ball_paddle&quot;;
import { UpdatePositionMessage } from &quot;game/messages/update_position&quot;;
import { UpdateVelocityMessage } from &quot;game/messages/update_velocity&quot;;
import { len, rotate, sub } from &quot;lua-lib/hump/vectorlight&quot;;

@Reads(BallPaddleCollisionMessage)
@Emits(UpdatePositionMessage, UpdateVelocityMessage)
export class BallPaddleCollisionEngine extends Engine {
    public update() {
        for (const message of this.read_messages(BallPaddleCollisionMessage).values()) {
            const ball_position = message.ball_entity.get_component(PositionComponent);
            const ball_velocity = message.ball_entity.get_component(VelocityComponent);
            const ball_boundaries = message.ball_entity.get_component(BoundingBoxComponent);

            const paddle_height = message.paddle_entity.get_component(PaddleComponent).height;
            const paddle_y = message.paddle_entity.get_component(PositionComponent).y;

            const velocity_message = this.emit_component_message(UpdateVelocityMessage, ball_velocity);

            // calculate new ball velocity based on paddle contact
            const speed = len(ball_velocity.x, ball_velocity.y);
            const horizontal = ball_velocity.x &lt; 0 ? 1 : -1;

            const diff = message.touch.y - paddle_y;
            const scale = diff / (paddle_height * 0.5);
            const rotation = (scale * math.pi / 4);

            let [new_x_velocity, new_y_velocity] = rotate(rotation, speed, 0);
            new_x_velocity *= horizontal;

            [
                velocity_message.x_delta,
                velocity_message.y_delta,
            ] = sub(new_x_velocity, new_y_velocity, ball_velocity.x, ball_velocity.y);

            // calculate bounce position, remembering to re-transform coordinates to origin space
            const y_distance = Math.abs(message.ball_new_y - (message.touch.y + ball_boundaries.height * 0.5));
            const x_distance = Math.abs(message.ball_new_x - (message.touch.x + ball_boundaries.width * 0.5));

            const position_message = this.emit_component_message(UpdatePositionMessage, ball_position);
            position_message.x_delta = 2 * message.normal.x * x_distance;
            position_message.y_delta = 2 * message.normal.y * y_distance;
        }
    }
}
</code></pre>

<video width="75%" height="360" autoplay="autoplay" muted="muted" loop="loop" style="display: block; margin: 0 auto;">
    <source src="/images/bounce_angle.mp4" type="video/mp4">
</video>

<p>Now we have a game on our hands!</p>


<footer class=" footline" >
	
</footer>


        
        </div>
        

      </div>

    <div id="navigation">
        
        

        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        

        


	 
	 
		
			<a class="nav nav-prev" href="/pong/polish/" title="Finishing Touches"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/pong/polish/title/" title="Title" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>

    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/js/clipboard.min.js?1561583309"></script>
    <script src="/js/perfect-scrollbar.min.js?1561583309"></script>
    <script src="/js/perfect-scrollbar.jquery.min.js?1561583309"></script>
    <script src="/js/jquery.sticky.js?1561583309"></script>
    <script src="/js/featherlight.min.js?1561583309"></script>
    <script src="/js/html5shiv-printshiv.min.js?1561583309"></script>
    <script src="/js/modernizr.custom-3.6.0.js?1561583309"></script>
    <script src="/js/learn.js?1561583309"></script>
    <script src="/js/hugo-learn.js?1561583309"></script>

    <link href="/mermaid/mermaid.css?1561583309" type="text/css" rel="stylesheet" />
    <script src="/mermaid/mermaid.js?1561583309"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    <link rel="stylesheet" href="/css/syntax.css">
<script src="/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

  </body>
</html>

